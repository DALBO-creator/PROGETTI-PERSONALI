<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="./favicon.ico" type="image/x-icon">
    <title>Document</title>
    <link rel="stylesheet" href="./style.css">
</head>
<body>
  <main>
    <h1>I miei biglietti</h1>
    <div class="eventContainer" id="ticketContainer"></div>
  </main>
  <footer>
  <nav class="navbar">
            <ul>
                <li><a href="./">SCOPRI</a></li>
                <li><a href="./preferiti.html">PREFERITI</a></li>
                <li><a href="./biglietti.html">BIGLIETTI</a></li>
                <li><a href="./account.html">ACCOUNT</a></li>
            </ul>
        </nav>
</footer>


    <script>
    const container = document.getElementById("ticketContainer");
    const biglietti = JSON.parse(localStorage.getItem("biglietti")) || [];
    let preferiti = JSON.parse(localStorage.getItem("preferiti")) || [];
    const shareButtons = document.querySelectorAll('.shareEvent');

    if (biglietti.length === 0) {
      container.innerHTML = "<p>Nessun biglietto acquistato.</p>";
    } else {
      biglietti.forEach(event => {
        const card = document.createElement("div");
        card.classList.add("eventCard");
        card.innerHTML = `
          <img src="${event.image}" alt="${event.title}">
          <h2>${event.title}</h2>
          <p>${event.date}</p>
          <p>${event.location}</p>
          <button class="addToFavorite">Aggiungi ai Preferiti</button>
          <button class="shareEvent">Condividi Evento</button>
        `;
        const favoriteButton = card.querySelector(".addToFavorite");
        favoriteButton.addEventListener("click", () => {
            const exists = preferiti.some(f =>
            f.title === event.title && f.date === event.date
          );
          if (exists) {
            alert("Evento giÃ  nei preferiti!");
            return;
          }
          preferiti.push(event);
          localStorage.setItem("preferiti", JSON.stringify(preferiti));
          alert("Evento aggiunto ai preferiti!");
          favoriteButton.remove();
        });

        const shareButton = card.querySelector('.shareEvent');
        shareButton.addEventListener("click", () => {
          const title = card.querySelector('h2').textContent;
          const date = card.querySelectorAll('p')[0].textContent;
          const location = card.querySelectorAll('p')[1].textContent;
        
          const subject = encodeURIComponent("Ti consiglio questo evento!");
          const body = encodeURIComponent(`Guarda questo evento:\n${title}\n${date}\n${location}`);
          window.location.href = `mailto:?subject=${subject}&body=${body}`;
        });


        container.appendChild(card);
      });
    }
  </script>
</body>
</html>