<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="./favicon.ico" type="image/x-icon">
    <title>Home</title>
    <link rel="stylesheet" href="./style.css">

</head>
<body> 
    <header>
        <div class="searchbar">
            <input type="text" placeholder="Cerca eventi, luoghi...">
            <button type="submit">Cerca</button>
        </div>    
    </header>
    <main>
        <div class="eventContainer">
            <div class="eventCard">
                <img src="./images/event1.jpg" alt="Evento 1">
                <h2>Concerto di Musica Classica</h2>
                <p>Data: 15 Luglio 2024</p>
                <p>Luogo: Teatro Comunale di Brescia</p>
                <button class="buyTicket">Acquista Biglietto</button>
                <button class="addToFavorite">Aggiungi ai Preferiti</button>
                <button class="shareEvent">Condividi Evento</button>

            </div>
            <div class="eventCard">
                <img src="./images/event2.jpg" alt="Evento 2">
                <h2>Festival del Vino Franciacorta</h2>
                <p>Data: 22 Luglio 2024</p>
                <p>Luogo: Piazza della Loggia, Brescia</p>
                <button class="buyTicket">Acquista Biglietto</button>
                <button class="addToFavorite">Aggiungi ai Preferiti</button>
                <button class="shareEvent">Condividi Evento</button>
            </div>
            <div class="eventCard">
                <img src="./images/event3.jpg" alt="Evento 3">
                <h2>Mostra d’Arte Contemporanea</h2>
                <p>Data: 2 Agosto 2024</p>
                <p>Luogo: Museo di Santa Giulia, Brescia</p>
                <button class="buyTicket">Acquista Biglietto</button>
                <button class="addToFavorite">Aggiungi ai Preferiti</button>
                <button class="shareEvent">Condividi Evento</button>
            </div>
            <div class="eventCard">
                <img src="./images/event4.jpg" alt="Evento 4">
                <h2>Jazz sotto le Stelle</h2>
                <p>Data: 10 Agosto 2024</p>
                <p>Luogo: Castello di Brescia</p>
                <button class="buyTicket">Acquista Biglietto</button>
                <button class="addToFavorite">Aggiungi ai Preferiti</button>
                <button class="shareEvent">Condividi Evento</button>
            </div>
            <div class="eventCard">
                <img src="./images/event5.jpg" alt="Evento 5">
                <h2>Sagra del Formaggio</h2>
                <p>Data: 18 Agosto 2024</p>
                <p>Luogo: Piazza Arnaldo, Brescia</p>
                <button class="buyTicket">Acquista Biglietto</button>
                <button class="addToFavorite">Aggiungi ai Preferiti</button>
                <button class="shareEvent">Condividi Evento</button>
            </div>
            <div class="eventCard">
                <img src="./images/event6.jpg" alt="Evento 6">
                <h2>Notte Bianca di Brescia</h2>
                <p>Data: 24 Agosto 2024</p>
                <p>Luogo: Centro Storico, Brescia</p>
                <button class="buyTicket">Acquista Biglietto</button>
                <button class="addToFavorite">Aggiungi ai Preferiti</button>
                <button class="shareEvent">Condividi Evento</button>
            </div>
            <div class="eventCard">
                <img src="./images/event7.jpg" alt="Evento 7">
                <h2>Spettacolo Teatrale “Romeo e Giulietta”</h2>
                <p>Data: 1 Settembre 2024</p>
                <p>Luogo: Teatro Grande, Brescia</p>
                <button class="buyTicket">Acquista Biglietto</button>
                <button class="addToFavorite">Aggiungi ai Preferiti</button>
                <button class="shareEvent">Condividi Evento</button>
            </div>
            <div class="eventCard">
                <img src="./images/event8.jpg" alt="Evento 8">
                <h2>Mercato dell’Artigianato Locale</h2>
                <p>Data: 7 Settembre 2024</p>
                <p>Luogo: Corso Zanardelli, Brescia</p>
                <button class="buyTicket">Acquista Biglietto</button>
                <button class="addToFavorite">Aggiungi ai Preferiti</button>
                <button class="shareEvent">Condividi Evento</button>
            </div>
            <div class="eventCard">
                <img src="./images/event9.jpg" alt="Evento 9">
                <h2>Festival del Cinema Brescia</h2>
                <p>Data: 15 Settembre 2024</p>
                <p>Luogo: Cinema Nuovo Eden, Brescia</p>
                <button class="buyTicket">Acquista Biglietto</button>
                <button class="addToFavorite">Aggiungi ai Preferiti</button>
                <button class="shareEvent">Condividi Evento</button>
            </div>
            <div class="eventCard">
              <img src="https://www.stateofmind.it/wp-content/uploads/2021/06/Concerti-live-e-musica-registrata-differenze-nel-coinvolgimento-del-pubblico.jpeg" alt="Evento 10">
              <h2>Concerto di Ludovico Einaudi</h2>
              <p>Data: Ven 24 ott 21:00</p>
              <p>Luogo: Teatro Grande, Brescia</p>
              <button class="buyTicket">Acquista Biglietto</button>
              <button class="addToFavorite">Aggiungi ai Preferiti</button>
              <button class="shareEvent">Condividi Evento</button>
            </div>
            
            <div class="eventCard">
              <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRB_V44vtigSHv8i1TvrSnVlOEqL4Wd1I4eGA&s" alt="Evento 11">
              <h2>Mostra Van Gogh: Immersive Experience</h2>
              <p>Data: Sab 25 ott 10:00</p>
              <p>Luogo: Museo di Santa Giulia, Brescia</p>
              <button class="buyTicket">Acquista Biglietto</button>
              <button class="addToFavorite">Aggiungi ai Preferiti</button>
              <button class="shareEvent">Condividi Evento</button>
            </div>
            
            <div class="eventCard">
              <img src="https://birreriadane.com/wp-content/uploads/2021/11/IMG_24701.png" alt="Evento 12">
              <h2>Festival della Birra Artigianale</h2>
              <p>Data: Dom 26 ott 18:30</p>
              <p>Luogo: Brixia Forum, Via Caprera 5, Brescia</p>
              <button class="buyTicket">Acquista Biglietto</button>
              <button class="addToFavorite">Aggiungi ai Preferiti</button>
              <button class="shareEvent">Condividi Evento</button>
            </div>
            
            <div class="eventCard">
              <img src="https://images.unsplash.com/photo-1525182008055-f88b95ff7980?auto=format&fit=crop&w=900&q=60" alt="Evento 13">
              <h2>Stand-up Comedy Night</h2>
              <p>Data: Gio 30 ott 21:30</p>
              <p>Luogo: Latteria Molloy, Via Marziale Ducos 2B, Brescia</p>
              <button class="buyTicket">Acquista Biglietto</button>
              <button class="addToFavorite">Aggiungi ai Preferiti</button>
              <button class="shareEvent">Condividi Evento</button>
            </div>
            
            <div class="eventCard">
              <img src="https://www.sudtirol.com/images/jch-optimize/ng/images_header_summer_mercatino-natale-bressanone.webp" alt="Evento 14">
              <h2>Mercatini di Natale</h2>
              <p>Data: Sab 15 nov 09:00</p>
              <p>Luogo: Piazza della Loggia, Brescia</p>
              <button class="buyTicket">Acquista Biglietto</button>
              <button class="addToFavorite">Aggiungi ai Preferiti</button>
              <button class="shareEvent">Condividi Evento</button>
            </div>
            
            <div class="eventCard">
              <img src="https://citynews-torinotoday.stgy.ovh/~media/original-hi/5913725518763/11-settembre-fiera-del-fumetto-di-torino-3.jpg" alt="Evento 15">
              <h2>Fiera del Fumetto di Brescia</h2>
              <p>Data: Dom 16 nov 10:00</p>
              <p>Luogo: Brixia Forum, Brescia</p>
              <button class="buyTicket">Acquista Biglietto</button>
              <button class="addToFavorite">Aggiungi ai Preferiti</button>
              <button class="shareEvent">Condividi Evento</button>
            </div>
            
            <div class="eventCard">
              <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQ2hFLPe1R3N6TJvpvRy33-PkFryBEIIpurxA&s" alt="Evento 16">
              <h2>Street Food Festival</h2>
              <p>Data: Ven 7 nov 18:00</p>
              <p>Luogo: Parco Tarello, Brescia</p>
              <button class="buyTicket">Acquista Biglietto</button>
              <button class="addToFavorite">Aggiungi ai Preferiti</button>
              <button class="shareEvent">Condividi Evento</button>
            </div>
            
            <div class="eventCard">
              <img src="https://www.asi.it/wp-content/uploads/2024/12/interstellar-web.jpg" alt="Evento 17">
              <h2>Proiezione di Interstellar</h2>
              <p>Data: Mer 5 nov 20:30</p>
              <p>Luogo: Cinema Nuovo Eden, Via Nino Bixio 9, Brescia</p>
              <button class="buyTicket">Acquista Biglietto</button>
              <button class="addToFavorite">Aggiungi ai Preferiti</button>
              <button class="shareEvent">Condividi Evento</button>
            </div>
            
            <div class="eventCard">
              <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQvFuUh_8wlOzf6OgzUqfPpXi3f1fBQLn4AzA&s" alt="Evento 18">
              <h2>Corsa dei Babbi Natale</h2>
              <p>Data: Dom 14 dic 10:30</p>
              <p>Luogo: Piazza Vittoria, Brescia</p>
              <button class="buyTicket">Acquista Biglietto</button>
              <button class="addToFavorite">Aggiungi ai Preferiti</button>
              <button class="shareEvent">Condividi Evento</button>
            </div>
            
            <div class="eventCard">
              <img src="https://upload.wikimedia.org/wikipedia/commons/7/74/Roma_campidoglio_notte_bianca_2006.jpg" alt="Evento 19">
              <h2>Notte Bianca della Cultura</h2>
              <p>Data: Sab 6 dic 19:00</p>
              <p>Luogo: Centro Storico, Brescia</p>
              <button class="buyTicket">Acquista Biglietto</button>
              <button class="addToFavorite">Aggiungi ai Preferiti</button>
              <button class="shareEvent">Condividi Evento</button>
            </div>
            
            <div class="eventCard">
              <img src="https://www.semprenews.it/files/magazine/img/size1/Concerto_Natale_in_Vaticano.jpg" alt="Evento 20">
              <h2>Concerto di Natale</h2>
              <p>Data: Sab 20 dic 21:00</p>
              <p>Luogo: Duomo Vecchio, Brescia</p>
              <button class="buyTicket">Acquista Biglietto</button>
              <button class="addToFavorite">Aggiungi ai Preferiti</button>
              <button class="shareEvent">Condividi Evento</button>
            </div>
        </div>    
    </main>
    <footer>
        <nav class="navbar">
            <ul>
                <li><a href="./">SCOPRI</a></li>
                <li><a href="./preferiti.html">PREFERITI</a></li>
                <li><a href="./biglietti.html">BIGLIETTI</a></li>
                <li><a href="./account.html">ACCOUNT</a></li>
            </ul>
        </nav>
    </footer>
    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const favoriteButtons = document.querySelectorAll('.addToFavorite');
            const ticketButtons = document.querySelectorAll('.buyTicket');
            const shareButtons = document.querySelectorAll('.shareEvent');

            favoriteButtons.forEach(button => {
                button.addEventListener('click', () => {
                    const card = button.closest('.eventCard');
                    const paragraphs = card.querySelectorAll('p');
                    const buttons = card.querySelectorAll('button');
                    
                    const eventData = {
                        image: card.querySelector('img').src,
                        title: card.querySelector('h2').textContent,
                        date: paragraphs[0].textContent,
                        location: paragraphs[1].textContent,
                        buyTicketButton: buttons[0].innerText,
                        shareButton: buttons[2].innerText,
                    };
                
                    let preferiti = JSON.parse(localStorage.getItem('preferiti')) || [];
                    const exists = preferiti.some(event => event.title === eventData.title && event.date === eventData.date);
                    if (exists) {
                        alert('Evento già presente nei preferiti!');
                        return;
                    }
                    else {
                        preferiti.push(eventData);
                        localStorage.setItem('preferiti', JSON.stringify(preferiti));
                        alert('Evento aggiunto ai preferiti!');
                    }
                });
            });

            /*
                const exist = prefriti.some (event => event.title === eventCard.title && event.data === eventCard.Data);  
                prefriti.some controlla se nell'array preferiti esiste già un evento con lo stesso titolo e data. ritorna un boolean (true o false)  
                avrei potutto usare anche find, che però ritorna l'elemento trovato invece che un boolean, 
                oppure un ciclo for classico per scorrere l'array e confrontare ogni elemento
            */

            ticketButtons.forEach(button => {
               button.addEventListener('click', () => {
                  const card = button.closest('.eventCard');
                  const paragraphs = card.querySelectorAll('p');
                  const buttons = card.querySelectorAll('button');
                  const eventData = {
                     image: card.querySelector('img').src,
                     title: card.querySelector('h2').textContent,
                     date: paragraphs[0].textContent,
                     location: paragraphs[1].textContent,
                     favoriteButton: buttons[1].innerText,
                     shareButton: buttons[2].innerText,
                  };
              
                    let biglietti = JSON.parse(localStorage.getItem('biglietti')) || [];
                    const exist = biglietti.some(event =>
                     event.title === eventData.title && event.date === eventData.date
                    );
                    if (exist) {
                     alert('Biglietto già acquistato per questo evento!');
                     return;
                  } else {
                     biglietti.push(eventData);
                     localStorage.setItem('biglietti', JSON.stringify(biglietti));
                     alert('Biglietto acquistato con successo!');
                  }
               });
            });

            // condivisione dell'evento via mail (mailto) --> endcodeURIComponent (subject e body) 
            //  per gestire spazi e caratteri speciali, poi si costruisce il link mailto con subject e body
            //  e si reindirizza l'utente a quel link, window.location.href = `mailto:?subject=${subject}&body=${body}`; serve per
            //  aprire il client di posta predefinito (o sceglierlo se è la prima volta) con il nuovo messaggio pronto per essere inviato.
            

            shareButtons.forEach(button => {
                button.addEventListener("click", () => {
                    const card = button.closest('.eventCard');
                    const title = card.querySelector('h2').textContent;
                    const date = card.querySelectorAll('p')[0].textContent;
                    const location = card.querySelectorAll('p')[1].textContent;
                    
                    const subject = encodeURIComponent("Ti consiglio questo evento!");
                    const body = encodeURIComponent(`Guarda questo evento:\n${title}\n${date}\n${location}`);
                    window.location.href = `mailto:?subject=${subject}&body=${body}`;
                });
            });

        });

            //gestione della searchbar:
            //vedo se l'input compare nel titlo
            //display di quelle in cui non campare = "none", in quella in cui compare = ""

            document.querySelector('.searchbar input').addEventListener('input', e => {
            const inputAttuale = e.target.value.toLowerCase().trim();
            const cards = document.querySelectorAll('.eventCard');
            
            cards.forEach(card => {
            const title = card.querySelector('h2').textContent.toLowerCase();
            const data = card.querySelector('p').textContent.toLowerCase();
            
        
            // Mostra/nascondi in base alla ricerca
            if (title.includes(inputAttuale)||data.includes(inputAttuale)) {
              card.style.display = '';
            } else {
              card.style.display = 'none';
            }

          });

        });
    </script>
</body>
</html>